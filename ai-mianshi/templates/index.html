<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>牛客AI面试教练</title>
    <style>
      :root {
        --bg: #0b1220;
        --panel: #111a2e;
        --panel-2: #0f172a;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --border: rgba(255, 255, 255, 0.08);
        --brand: #7c3aed;
        --brand-2: #a78bfa;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
        background: radial-gradient(1200px 600px at 20% 10%, rgba(124, 58, 237, 0.2), transparent 60%),
          radial-gradient(900px 500px at 70% 20%, rgba(59, 130, 246, 0.16), transparent 65%),
          var(--bg);
        color: var(--text);
      }
      .app {
        display: grid;
        grid-template-columns: 320px 1fr 360px;
        gap: 14px;
        padding: 14px;
        height: 100vh;
      }
      .panel {
        border: 1px solid var(--border);
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.04), transparent 70%), var(--panel);
        border-radius: 12px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }
      .panel-header {
        padding: 12px 14px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }
      .panel-title {
        font-weight: 650;
        font-size: 14px;
        letter-spacing: 0.2px;
      }
      .panel-body {
        padding: 14px;
        overflow: auto;
        min-height: 0;
      }
      label {
        display: block;
        font-size: 12px;
        color: var(--muted);
        margin: 10px 0 6px;
      }
      input[type="text"],
      input[type="password"],
      input[type="number"],
      select {
        width: 100%;
        padding: 10px 10px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: var(--panel-2);
        color: var(--text);
        outline: none;
      }
      input[type="file"] {
        width: 100%;
        padding: 8px 0;
        color: var(--muted);
      }
      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      .btn {
        width: 100%;
        margin-top: 12px;
        padding: 10px 12px;
        border: 1px solid rgba(124, 58, 237, 0.55);
        background: linear-gradient(180deg, rgba(124, 58, 237, 0.35), rgba(124, 58, 237, 0.18));
        color: #fff;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 650;
      }
      .btn:disabled {
        cursor: not-allowed;
        opacity: 0.55;
      }
      .hint {
        margin-top: 10px;
        color: var(--muted);
        font-size: 12px;
        line-height: 1.6;
      }
      .badge {
        font-size: 12px;
        color: var(--muted);
        border: 1px solid var(--border);
        padding: 3px 8px;
        border-radius: 999px;
      }
      .report {
        white-space: pre-wrap;
        word-break: break-word;
        line-height: 1.6;
        font-size: 13px;
      }
      .warnings {
        border: 1px dashed rgba(245, 158, 11, 0.55);
        background: rgba(245, 158, 11, 0.08);
        color: #fbbf24;
        padding: 10px 12px;
        border-radius: 10px;
        margin-bottom: 10px;
        font-size: 12px;
        line-height: 1.6;
        display: none;
      }
      .q-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .q-item {
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.03);
        border-radius: 10px;
        padding: 10px 12px;
      }
      .q {
        font-size: 13px;
        line-height: 1.5;
        margin: 0 0 6px;
      }
      .q-meta {
        font-size: 12px;
        color: var(--muted);
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      a {
        color: var(--brand-2);
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      @media (max-width: 1100px) {
        .app {
          grid-template-columns: 1fr;
          height: auto;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <section class="panel">
        <div class="panel-header">
          <div class="panel-title">输入</div>
          <div class="badge">GLM-4.6 + 牛客</div>
        </div>
        <div class="panel-body">
          <form id="form">
            <label>GLM-4.6 API Key</label>
            <input id="apiKey" name="api_key" type="password" placeholder="复制粘贴你的 API Key" required />

            <label>牛客网搜索词（公司+岗位）</label>
            <input id="keyword" name="keyword" type="text" placeholder="例如：字节跳动 前端" required />

            <label>PDF 简历（可选）</label>
            <input id="resume" name="resume_file" type="file" accept="application/pdf" />

            <div class="row">
              <div>
                <label>分析模块</label>
                <select id="module" name="module">
                  <option value="experience">面经总结与考点分析</option>
                  <option value="predict">模拟面试题目预测</option>
                  <option value="resume">简历优化建议</option>
                </select>
              </div>
              <div>
                <label>最大抓取面经数量</label>
                <input id="maxCount" name="max_count" type="number" min="1" max="30" value="8" />
              </div>
            </div>

            <button id="submitBtn" class="btn" type="submit">生成分析报告</button>
            <div class="hint">
              如果牛客抓取被拦截，右侧题库可能为空，但仍会基于关键词与简历生成报告。
            </div>
          </form>
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <div class="panel-title">分析报告</div>
          <div id="status" class="badge">就绪</div>
        </div>
        <div class="panel-body">
          <div id="warnings" class="warnings"></div>
          <div id="report" class="report">请在左侧填写信息并点击“生成分析报告”。</div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <div class="panel-title">原始问题题库</div>
          <div id="qCount" class="badge">0</div>
        </div>
        <div class="panel-body">
          <div id="qList" class="q-list"></div>
        </div>
      </section>
    </div>

    <script>
      const form = document.getElementById("form");
      const submitBtn = document.getElementById("submitBtn");
      const statusEl = document.getElementById("status");
      const reportEl = document.getElementById("report");
      const warningsEl = document.getElementById("warnings");
      const qListEl = document.getElementById("qList");
      const qCountEl = document.getElementById("qCount");

      function setStatus(text) {
        statusEl.textContent = text;
      }

      function setWarnings(warnings) {
        if (!warnings || warnings.length === 0) {
          warningsEl.style.display = "none";
          warningsEl.textContent = "";
          return;
        }
        warningsEl.style.display = "block";
        warningsEl.textContent = warnings.join("\n");
      }

      function renderQuestionBank(items) {
        qListEl.innerHTML = "";
        const list = Array.isArray(items) ? items : [];
        qCountEl.textContent = String(list.length);
        for (const it of list) {
          const div = document.createElement("div");
          div.className = "q-item";
          const p = document.createElement("p");
          p.className = "q";
          p.textContent = it.question || "";
          const meta = document.createElement("div");
          meta.className = "q-meta";
          const title = document.createElement("span");
          title.textContent = it.source_title || "来源";
          meta.appendChild(title);
          if (it.source_url) {
            const a = document.createElement("a");
            a.href = it.source_url;
            a.target = "_blank";
            a.rel = "noreferrer";
            a.textContent = "打开链接";
            meta.appendChild(a);
          }
          div.appendChild(p);
          div.appendChild(meta);
          qListEl.appendChild(div);
        }
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        submitBtn.disabled = true;
        setStatus("生成中…");
        reportEl.textContent = "正在抓取面经并调用 GLM-4.6，请稍候…";
        setWarnings([]);
        renderQuestionBank([]);

        const fd = new FormData(form);
        try {
          const resp = await fetch("/analyze", { method: "POST", body: fd });
          const data = await resp.json().catch(() => ({}));
          if (!resp.ok) {
            setStatus("失败");
            setWarnings(data.warnings || []);
            reportEl.textContent = data.error || "请求失败";
            renderQuestionBank(data.question_bank || []);
            return;
          }
          setStatus("完成");
          setWarnings(data.warnings || []);
          reportEl.textContent = data.report_markdown || "";
          renderQuestionBank(data.question_bank || []);
        } catch (err) {
          setStatus("失败");
          reportEl.textContent = String(err || "请求失败");
        } finally {
          submitBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>

